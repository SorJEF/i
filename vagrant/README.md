# Vagrant Multi-Machine конфігурація для розробки igov порталу

В цьому репозиторії знаходяться [Vagrant](http://vagrantup.com) конфігурації для початку розробки [igov](http://igov.org.ua) проекту. Для того щоб розгорнути кожен компонент самостійно дивіться [Встановити все, але самостійно](https://github.com/e-government-ua/i/wiki/%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0-%D0%B2%D1%81%D0%B5%D1%85-%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%D0%BE%D0%B2)

## Перш ніж почати
1. Встановить [Vagrant](http://docs.vagrantup.com/v2/installation/index.html)
1. Встановить [VirtualBox](https://www.virtualbox.org/wiki/Downloads)

## Початок
Щоб запустити усі компоненти відкрийте термінал, перейдіть в директорію з Vagrantfile файлом та наберіть:

    vagrant up

Через 10-30 хвилин, будуть розгорнуті наступні компоненти в VirtualBox з якими можна почати роботу за наступними посиланнями:
* `central-js` - http://192.168.10.10:9000/
* `dashboard-js` - http://192.168.10.11:9000/
* `wf-central` - http://192.168.10.12:8080/wf-central/
* `wf-region` - http://192.168.10.13:8080/wf-region/

## Розгортання окремих компонент

Ви також можете розгорнути кожну компоненту окрему, для цього наберіть:

    vagrant up [ім'я компоненти]

Для перезавантаження віртуалки

    vagrant reload [ім'я компоненти]

Коли віртуалка вам буде більше не потрібна наберіть:

    vagrant suspend [ім'я компоненти (опціонально)]

або якщо ви хочете її повністю вимкнути
    
    vagrant halt [ім'я компоненти (опціонально)]

Щоб повністю знищити віртуалку, наберіть:

    vagrant destroy [ім'я компоненти (опціонально)]

## Розробка
Робочи директорії на вашому комп'ютері автоматично синхронізуються з директоріями на віртуалці, тому усі зміни в файлах будуть також доступні на віртуалці.

Наразі увесь проект розміщується в теці `/project` на виртуалці.

### Для node.js/front-end розробників (`central-js`, `dashboard-js`)

JS компоненти самі перезавантажуються після будь-яких змін в файлах. Тому ви можете почати розробку без налаштовування локального середовища.

Якщо вам потрібно розгорнути компоненту локально для під'єднання до розгорнутих `wf-central`, `wf-region` скопіюйте вже створені конфігурації з теки [vagrant/config](vagrant/config). Приклад Unix команди:

    cp vagrant/config/central-js.env.js central-js/server/config/local.env.js 

### Для java/activiti розробників (`wf-central`, `wf-region`)

Щоб підтягнути зміни в файлах `wf-central`, `wf-region` компоненти потрібно перезавантажувати самостійно наступними командами:

    vagrant reload wf-central
    vagrant reload wf-region

Якщо ви хочете розгорнути компоненти локально та під'єднати node.js компоненти на віртуалці до ваших локальних сервісів, замінить налаштування конфігурацій в теці [vagrant/config](vagrant/config). Вам необхідно буде замінити IP java компонент на IP своєї host машини. Зміни підтягуються автоматично.

## Виправлення помилок
Якщо виникли якісь помилки в процесі розгортання та ви хочете перезапутити процес, наберіть:

    vagrant destroy && vagrant up

Також ви можете приєднатися до віртуалки, якщо вона вже розгорнута. В терміналі наберіть:

    vagrant ssh [ім'я компоненти]

Після того як ви приєднались через ssh до терміналу віртуалки, для JavaScript компонент (`central-js`, `dashboard-js`) ви можете набрати наступну команду щоб побачити лог `grunt` процесу:

    screen -r app

Щоб від'єднатись від `grunt` процесу натисніть `ctrl+a+d`

## Рекомендації

### vagrant-faster
Встановить [vagrant-faster](https://github.com/rdsubhas/vagrant-faster/) плагін, щоб віртуалкам в VirtualBox виділялось більше пам'яті та процесорних ресурсів, залежно від конфігурації вашого комп'ютера.

    vagrant plugin install vagrant-faster
